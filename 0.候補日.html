<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>0.候補日（10候補）</title>
</head>
<body>
<h3>候補日（10候補）</h3>

<p>日付と時間帯を入力してください：</p>

<script>
// ①～⑩
const slots = ["①","②","③","④","⑤","⑥","⑦","⑧","⑨","⑩"];

const timeOptions = [
  "10:00～11:00",
  "11:30～12:30",
  "13:00～14:00",
  "14:30～15:30",
  "16:00～17:00",
  "17:30～18:30",
  "19:00～20:00",
  "20:30～21:30"
];
</script>

<form id="scheduleForm">
<div id="inputs"></div>
<br><br>
<button type="button" id="generateBtn">日程を生成</button>
<button type="button" id="saveBtn">テキストを保存</button>
</form>

<textarea id="output" rows="18" cols="50" readonly placeholder="ここに日程候補が表示されます"></textarea>

<script>
// 入力欄を10個生成
const inputsDiv = document.getElementById("inputs");
for(let i=0;i<10;i++){
    const slotLabel = document.createElement("label");
    slotLabel.textContent = slots[i] + " 日付: ";

    const dateInput = document.createElement("input");
    dateInput.type = "date";
    dateInput.id = "date"+i;

    const timeLabel = document.createElement("span");
    timeLabel.textContent = " 時間: ";

    const timeSelect = document.createElement("select");
    timeSelect.id = "time"+i;

    timeOptions.forEach(t=>{
        const opt = document.createElement("option");
        opt.value = t;
        opt.textContent = t;
        timeSelect.appendChild(opt);
    });

    slotLabel.appendChild(dateInput);
    slotLabel.appendChild(timeLabel);
    slotLabel.appendChild(timeSelect);
    inputsDiv.appendChild(slotLabel);
    inputsDiv.appendChild(document.createElement("br"));
}

// 日程生成（選んだ日付を昇順ソートして①〜⑩を付けて表示）
document.getElementById("generateBtn").addEventListener("click", ()=>{
    const week = ["日","月","火","水","木","金","土"];
    let items = [];

    for(let i=0;i<10;i++){
        const dateVal = document.getElementById("date"+i).value;
        const timeVal = document.getElementById("time"+i).value;
        if(dateVal){
            items.push({
                dateVal,
                timeVal,
                dateObj: new Date(dateVal)
            });
        }
    }

    // 日付昇順ソート
        // 日付と時間で昇順ソート
    items.sort((a,b)=>{
        const diff = a.dateObj - b.dateObj;
        if(diff !== 0) return diff;
        // 時間帯 "HH:MM～HH:MM" の開始時刻で比較
        const toMinutes = t => {
            const start = t.split("～")[0];
            const [h,m] = start.split(":" ).map(Number);
            return h*60 + m;
        };
        return toMinutes(a.timeVal) - toMinutes(b.timeVal);
    });((a,b)=> a.dateObj - b.dateObj);

    let outputText = "";

    items.forEach((item, idx)=>{
        const d = item.dateObj;
        const month = d.getMonth()+1;
        const day = d.getDate();
        const dayOfWeek = week[d.getDay()];
        const num = slots[idx]; // ソート後に①〜⑩を振る
        outputText += `${num} ${month}/${day}(${dayOfWeek}) ${item.timeVal}\n`;
    });

    document.getElementById("output").value = outputText.trim();
});

// テキスト保存
document.getElementById("saveBtn").addEventListener("click", ()=>{
    const text = document.getElementById("output").value;
    if(!text){
        alert("まず日程を生成してください");
        return;
    }
    const blob = new Blob([text], {type:"text/plain"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "VST日程調整.txt";
    a.click();
    URL.revokeObjectURL(url);
});
</script>
</body>
</html>
